(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{44707:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/categories",function(){return a(49045)}])},16837:function(e,t,a){"use strict";var r=a(85893),o=a(11163);t.Z=()=>{let e=(0,o.useRouter)();return(0,r.jsxs)("aside",{className:"w-64 bg-white  relative z-10",children:[(0,r.jsx)("div",{className:"px-6 py-4 text-xl font-bold border-b",children:"e-Diary MS"}),(0,r.jsxs)("nav",{className:"p-4 space-y-2",children:[(0,r.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"block w-full text-left px-3 py-2 rounded hover:bg-gray-100 font-medium",children:"Dashboard"}),(0,r.jsx)("button",{onClick:()=>e.push("/categories"),className:"block w-full text-left px-3 py-2 rounded hover:bg-gray-100",children:"Categories"}),(0,r.jsx)("button",{onClick:()=>e.push("/notes"),className:"block w-full text-left px-3 py-2 rounded hover:bg-gray-100",children:"Notes"}),(0,r.jsx)("div",{className:"pt-4 border-t text-sm text-gray-500",children:"PROFILE SETTINGS"}),(0,r.jsx)("button",{onClick:()=>e.push("/changePassword"),className:"block w-full text-left px-3 py-2 rounded hover:bg-gray-100",children:"Change Password"}),(0,r.jsx)("button",{onClick:()=>e.push("/myProfile"),className:"block w-full text-left px-3 py-2 rounded hover:bg-gray-100",children:"My Profile"}),(0,r.jsx)("button",{onClick:()=>e.push("/"),className:"block w-full text-left px-3 py-2 rounded hover:bg-gray-100",children:"Logout"})]})]})}},49045:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return categories}});var r=a(85893),o=a(67294),s=a(51024),l=a(2307),n=a(65400),i=a.n(n),c=a(56697),d=a(64749),u=a(11187),h=a(16837),components_DeleteModal=e=>{let{isOpen:t,onClose:a,onConfirm:o}=e;return t?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-80 p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Confirm Delete"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to delete this note?"}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"}),(0,r.jsx)("button",{onClick:o,className:"px-4 py-2 text-white bg-red-600 rounded hover:bg-red-700",children:"Delete"})]})]})}):null};let{Option:g}=d.default;var categories=()=>{let[e,t]=(0,o.useState)([]),[a,n]=(0,o.useState)(""),[y,p]=(0,o.useState)(!1),[x,m]=(0,o.useState)(!1),[f,w]=(0,o.useState)(null),[b,C]=(0,o.useState)(""),[j,k]=(0,o.useState)(!1),[v,N]=(0,o.useState)(null),[S,P]=(0,o.useState)(!1),[E,Z]=(0,o.useState)(""),fetchCategories=async()=>{try{p(!0);let e=localStorage.getItem("token"),a=await fetch("".concat("https://ediary-management-system-production-ed2f.up.railway.app","/entries/getCategory"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include"});if(!a.ok)throw Error(await a.text());let r=await a.json(),o=r.reduce((e,t)=>{let a=t.category||"Uncategorized";return e[a]||(e[a]={total:0,last:t.updated_at,id:t.id,status:t.status}),e[a].total+=1,new Date(t.updated_at)>new Date(e[a].last)&&(e[a].last=t.updated_at,e[a].id=t.id,e[a].status=t.status),e},{}),s=Object.keys(o).map(e=>({key:o[e].id,id:o[e].id,category:e,totalUsed:o[e].total,lastUpdate:new Date(o[e].last).toLocaleString(),status:o[e].status||"active"}));t(s)}catch(e){console.error("Fetch failed:",e)}finally{p(!1)}};(0,o.useEffect)(()=>{fetchCategories()},[]);let handleAddCategory=async()=>{if(!E.trim()){u.ZP.error("Category name is required");return}try{let e=localStorage.getItem("token"),t=await fetch("".concat("https://ediary-management-system-production-ed2f.up.railway.app","/entries/categoryName"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({category:E,status:"active"}),credentials:"include"});if(!t.ok)throw Error(await t.text());u.ZP.success("Category added successfully"),P(!1),Z(""),fetchCategories()}catch(e){console.error("Add failed:",e),u.ZP.error("Failed to add category")}},handleDelete=async e=>{try{let a=localStorage.getItem("token"),r=await fetch("".concat("https://ediary-management-system-production-ed2f.up.railway.app","/entries/deletecategory/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)},credentials:"include"});if(!r.ok)throw Error(await r.text());t(t=>t.filter(t=>t.id!==e)),u.ZP.success("Category deleted"),console.log(e)}catch(e){console.error("Delete failed:",e),u.ZP.error("Failed to delete category")}},eidtCategory=async()=>{if(!b.trim()){u.ZP.error("Category is required");return}try{let e=localStorage.getItem("token"),a=await fetch("".concat("https://ediary-management-system-production-ed2f.up.railway.app","/entriescategory/").concat(f.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},credentials:"include",body:JSON.stringify({category:b})});if(!a.ok)throw Error(await a.text());let r=new Date().toLocaleString();t(e=>e.map(e=>e.id===f.id?{...e,category:b,lastUpdate:r}:e)),m(!1),w(null),C(""),u.ZP.success("Category updated")}catch(e){console.error("Update failed:",e),u.ZP.error("Failed to update")}},handleStatusChange=async(e,a)=>{try{let r=localStorage.getItem("token"),o=await fetch("".concat("https://ediary-management-system-production-ed2f.up.railway.app","/entries/category/").concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},credentials:"include",body:JSON.stringify({category:e.category,status:a})});if(!o.ok)throw Error(await o.text());t(t=>t.map(t=>t.id===e.id?{...t,status:a}:t)),u.ZP.success("Status updated"),console.log(e)}catch(e){console.error("Status update failed:",e),u.ZP.error("Failed to update status")}},_=[{title:"Name",dataIndex:"category",key:"category"},{title:"Total Used",dataIndex:"totalUsed",key:"totalUsed"},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>(0,r.jsxs)(d.default,{value:t.status,style:{width:100},onChange:e=>handleStatusChange(t,e),children:[(0,r.jsx)(g,{value:"active",children:"Active"}),(0,r.jsx)(g,{value:"inactive",children:"Disable"})]})},{title:"Last update",dataIndex:"lastUpdate",key:"lastUpdate"},{title:"Action",key:"action",render:(e,t)=>(0,r.jsxs)("div",{className:"space-x-3",children:[(0,r.jsx)(i(),{size:"small",onClick:()=>{w(t),C(t.category),m(!0)},children:"Edit"}),(0,r.jsx)(i(),{size:"small",danger:!0,onClick:()=>{N(t.id),k(!0)},children:"Delete"})]})}],D=e.filter(e=>e.category.toLowerCase().includes(a.toLowerCase()));return(0,r.jsxs)("div",{className:"bg-[url('/images/dashboard/dashboard_back.png')] bg-no-repeat bg-cover min-h-screen flex",children:[(0,r.jsx)("div",{className:"min-h-screen w-64 bg-white shadow-lg",children:(0,r.jsx)(h.Z,{})}),(0,r.jsxs)("div",{className:"flex-1 p-6 overflow-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)(s.Z,{placeholder:"Search category...",value:a,onChange:e=>n(e.target.value),className:"max-w-[250px]"}),(0,r.jsx)("button",{className:"ml-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",onClick:()=>P(!0),children:"+ Add Category"})]}),(0,r.jsx)("div",{className:"bg-white rounded-md shadow w-full",children:(0,r.jsx)(l.Z,{rowKey:"id",columns:_,dataSource:D,loading:y,pagination:{pageSize:5}})})]}),(0,r.jsx)(components_DeleteModal,{isOpen:j,onClose:()=>k(!1),onConfirm:async()=>{v&&(await handleDelete(v),N(null)),k(!1)}}),(0,r.jsx)(c.Z,{title:"Edit Category",open:x,onOk:eidtCategory,onCancel:()=>m(!1),okText:"Save",children:(0,r.jsx)(s.Z,{value:b,onChange:e=>C(e.target.value)})}),(0,r.jsx)(c.Z,{title:"Add New Category",open:S,onOk:handleAddCategory,onCancel:()=>P(!1),okText:"Add",children:(0,r.jsx)(s.Z,{placeholder:"Enter category name",value:E,onChange:e=>Z(e.target.value)})})]})}}},function(e){e.O(0,[874,59,186,774,888,179],function(){return e(e.s=44707)}),_N_E=e.O()}]);